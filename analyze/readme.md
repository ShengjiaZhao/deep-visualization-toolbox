# 图像的检索
## 背景
CNN在很多识别任务中都有极好的表现，研究也说明，被训练用来图片分类的CNN可以在网络的高层生成非常有意义的特征检测器，虽然这些特征并不是标签(Label)的一部分．
这一实验尝试利用这些Feature进行图像检索

## Baseline方法
首先我们尝试一种比较简单的方法，直接用预训练的CaffeNet的conv5层feature，用距离二范数度量作为相似度进行检索．
也就是说，假设图片$x_1, ..., x_n$产生feature向量为$f_1, ..., f_n$，查询图片的feature向量为$f_q$，那么我们希望寻找图片
\[ \argmin_{1 \leq k \leq n} ||f_k - f_q||_2 \]

## 实验
Demo可以打开链接(http://52.53.218.78:8889/notebooks/ImageSearch.ipynb)运行．将
```url=""```
这句里的url改成图片的网址，选择　Kernel->Restart and Run All　程序会下载该图片，并且检索近似的图片

Demo开放至2016.6.15

# 稀疏性提高图像检索质量
## 方法
通常在CNN中，无关的节点也会发放，如果我们绘制发放值的分布(Histogram)，便会发现每一个节点都会有大量的图片有不同程度的发放．
我们希望尽可能地抑制无关特征的发放．一种解决办法是，对网络的发放加入稀疏惩罚$\lambda ||h||_1$. 这里$h$是希望加入稀疏惩罚的节点．
这里采用预训练的CaffeNet，在此基础上直接加入稀疏惩罚以较小的学习率对网络进行Fine Tune

## 训练结果
首先可以看出，网络在测试集上的精度不但没有降低，反而有所提高，说明稀疏性是很好的

# 实验结果
因为不知道图像库中匹配的图片的实际数量，所以无法计算召回率(Recall)，故这里采用精度(Precision)，即前n个返回结果正确的百分比来衡量Retrieval的效果．
具体操作如下:
1. 从网络上随机寻找一张不在训练集中的测试图片，随机选择一个检索器对其进行匹配
2. 评判者看测试图片，并对图片主题内容进行描述
3. 评判者依次查看未知的检索器取回的图片，判断是不是至少符合描述的一部分
因为评判者不知道生成结果的检索器，便可以公正的评判．同时事先生成描述非常有利于评判的客观性．人类的感知常常会受到期望影响，如果人们期望两张图片是相似的，
那么一些相似点很可能被找到，反之依然．因此在比对前预先总结图片的关键点，并仅仅对关键点进行匹配，使得不同人的评判结果更加接近

下图是两个不同的检索器前n个结果和准确率之间的关系．可以看出加入了稀疏性的网络在检索任务中明显表现更好